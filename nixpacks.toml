[phases.setup]
nixPkgs = ["nodejs-18_x", "npm-9_x"]

[phases.install]
cmds = ["npm ci"]

[phases.build]
cmds = [
  "npm run build",
  "ls -la dist/",
  "if [ -d 'dist/public' ]; then echo 'Moving files from dist/public to dist/'; cp -r dist/public/* dist/ && rm -rf dist/public; fi",
  "ls -la dist/",
  "echo 'Build completed successfully'"
]

[start]
cmd = "npm start"

[variables]
NODE_ENV = "production"
PORT = "8080"