[phases.setup]
nixPkgs = ["nodejs-18_x", "npm-9_x"]

[phases.install]
cmds = ["npm ci --include=dev"]

[phases.build]
cmds = [
  "echo 'ğŸ”¨ Starting build process...'",
  "npm run build",
  "echo 'ğŸ“ Checking build output structure...'",
  "ls -la dist/",
  "if [ -d 'dist/public' ]; then echo 'ğŸ“‚ Moving static files...'; cp -r dist/public/* dist/ && rm -rf dist/public; fi",
  "ls -la dist/",
  "echo 'âœ… Build process completed successfully'",
  "npm prune --production"
]

[start]
cmd = "npm start"

[variables]
NODE_ENV = "production"